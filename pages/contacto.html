<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AMC Sitio Web</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/CSS/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
</head>
<body>    
    <div id="top-bar" class="bg-dark text-white d-none d-md-block">
        <div class="container">
            <div class="row align-items-center">
                
                <div class="col-md-6 text-start small">
                    <span class="me-3"><i class="fas fa-envelope me-1"></i> amcglobalserviciossas@gmail.com</span>
                    <span><i class="fas fa-phone-alt me-1"></i> +57 316 8222210</span>
                </div>

                <div class="col-md-6 text-end">
                    <span class="me-3">Nuestras Redes Sociales</span>
                    <a href="#" class="text-white me-2"><i class="fab fa-facebook-f"></i></a>
                    <a href="#" class="text-white"><i class="fab fa-linkedin-in"></i></a>
                </div>
            </div>
        </div>
    </div>
    <header class="py-3 bg-white shadow-sm sticky-top">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-auto">
                    <a href="/index.html" class="d-flex align-items-center text-decoration-none">
                        <img src="/img/AMC_logo.png" alt="Logo AMC" class="logo img-fluid me-3">
                        <div>
                            <h1 class="siteTitle mb-0">AMC Global Servicios S.A.S.</h1>
                            <p class="siteSubtitle mb-0 d-none d-sm-block">Soluciones jurídicas a su medida</p>
                        </div>
                    </a>
                </div>
                
                <div class="col">
                    <nav class="navbar navbar-expand-lg p-0">
                        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNav" aria-controls="#mainNav" aria-expanded="false" aria-label="Toggle navigation">
                            <span class="navbar-toggler-icon"></span>
                        </button>
                        <div class="collapse navbar-collapse" id="mainNav">
                            <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
                                <li class="nav-item">
                                    <a class="nav-link" href="/index.html">INICIO</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="/pages/nosotros.html">NOSOTROS</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="contacto.html">CONTACTO</a>
                                </li>
                                <li class="nav-item dropdown">
                                    <a class="nav-link dropdown-toggle" href="#" id="serviciosDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">NUESTROS SERVICIOS</a>
                                    <ul class="dropdown-menu" aria-labelledby="serviciosDropdown">
                                        <li><a class="dropdown-item" href="./servicios/Der_ConAct.html">Derecho Contractual</a></li>
                                        <li><a class="dropdown-item" href="./servicios/Der_Civil.html">Derecho Civil</a></li>
                                        <li><a class="dropdown-item" href="./servicios/Der_Cat.html">Derecho Catastral</a></li>
                                        <li><a class="dropdown-item" href="./servicios/Acciones_const.html">Acciones Constitucionales</a></li>
                                    </ul>
                                </li>                                
                            </ul>
                        </div>
                    </nav>
                </div>
            </div>
        </div>
    </header>
    <main class="container mt-3 mb-5">
        <h1 class="text-center mb-5 text-primary">Contáctanos y Empecemos a Trabajar</h1>
        
        <!-- SECCIÓN PRINCIPAL: Información y Formulario -->
        <div class="row g-5">
            
            <!-- Columna de Información de Contacto  -->
            <div class="col-lg-5">
                <div class="p-4 bg-light rounded-3 shadow-sm h-100">
                    <h2 class="h4 mb-4 border-bottom pb-2">Información de AMC Global Servicios S.A.S.</h2>
                    
                    <p class="lead">Estamos listos para atender tus consultas y brindarte la asesoría legal que necesitas.</p>
                    
                    <ul class="list-unstyled mt-4">
                        <li class="d-flex align-items-start mb-3">
                            <i class="fas fa-envelope fa-2x text-primary me-3 pt-1"></i>
                            <div>
                                <h5 class="fw-bold mb-0">Correo Electrónico</h5>
                                <a href="mailto:amcglobalserviciossas@gmail.com" class="text-decoration-none">amcglobalserviciossas@gmail.com</a>
                            </div>
                        </li>
                        <li class="d-flex align-items-start mb-3">
                            <i class="fas fa-phone-alt fa-2x text-primary me-3 pt-1"></i>
                            <div>
                                <h5 class="fw-bold mb-0">Teléfono</h5>
                                <a href="tel:+573168222210" class="text-decoration-none">+57 316 8222210</a>
                            </div>
                        </li>
                        <li class="d-flex align-items-start mb-3">
                            <i class="fas fa-map-marker-alt fa-2x text-primary me-3 pt-1"></i>
                            <div>
                                <h5 class="fw-bold mb-0">Dirección Principal</h5>
                                <p class="mb-0">Colombia (Ubicación Geográfica Central)</p>
                            </div>
                        </li>
                    </ul>
                    
                    <h5 class="mt-5 border-top pt-3">Síguenos en nuestras Redes</h5>
                    <div class="social-links mt-3">
                        <a href="#" class="btn btn-outline-primary me-2"><i class="fab fa-facebook-f"></i></a>
                        <a href="#" class="btn btn-outline-primary"><i class="fab fa-linkedin-in"></i></a>
                    </div>
                </div>
            </div>

            <!-- Columna del Formulario de Contacto -->
            <div class="col-lg-7">
                <div class="p-4 rounded-3 shadow border">
                    <h2 class="h4 mb-4">Cuéntanos tu Caso</h2>
                    <p class="text-muted mb-4">Diligencia el siguiente formulario y un experto se pondrá en contacto contigo a la brevedad.</p>

                    <!-- llamar a la función de validación -->
                    <form id="contactForm" action="#" method="POST" onsubmit="return validateForm(event)">
                        
                        <!-- Campo: Nombre -->
                        <div class="mb-3">
                            <!-- label para sugerir un mínimo (Nombre y Apellido) -->
                            <label for="nombre" class="form-label">Nombre y Apellido</label>
                            <!-- atributo minlength para la validación de longitud mínima -->
                            <input type="text" class="form-control" id="nombre" name="nombre" placeholder="Ingresa tu nombre y apellido" required minlength="4">
                            <!-- Espacio para el mensaje de error del nombre -->
                            <div class="invalid-feedback" id="nombreError">
                                El nombre solo debe contener letras, tildes y espacios, y debe tener al menos 4 caracteres (ej: 'Jo Pa').
                            </div>
                        </div>
                        
                        <!-- Campo: Teléfono -->
                        <div class="mb-3">
                            <label for="telefono" class="form-label">Número Telefónico</label>
                            <!-- atributo minlength para forzar 10 dígitos (en la validación JS) -->
                            <input type="tel" class="form-control" id="telefono" name="telefono" placeholder="Ej: 3001234567" required>
                            <!-- Espacio para el mensaje de error del teléfono -->
                            <div class="invalid-feedback" id="telefonoError">
                                Por favor, introduce un número de teléfono válido, de al menos 10 dígitos (solo números, +, espacios o -).
                            </div>
                        </div>
                        
                        <!-- Campo: Correo Electrónico -->
                        <div class="mb-3">
                            <label for="email" class="form-label">Correo Electrónico</label>
                            <input type="email" class="form-control" id="email" name="email" placeholder="nombre@ejemplo.com" required>
                            <div class="invalid-feedback" id="emailError">
                                Por favor, introduce un correo electrónico válido y con extensión completa (ej: nombre@dominio.com).
                            </div>
                        </div>
                        
                        <!-- Campo: Coméntanos tu Caso -->
                        <div class="mb-4">
                            <label for="mensaje" class="form-label">Coméntanos tu Caso para Estudiarlo</label>
                            <!-- atributo minlength para el mínimo de 30 caracteres -->
                            <textarea class="form-control" id="mensaje" name="mensaje" rows="5" placeholder="Describe brevemente tu situación o consulta legal." required minlength="30"></textarea>
                            <div class="invalid-feedback" id="mensajeError">
                                El mensaje debe contener una descripción más detallada (mínimo 30 caracteres, aprox. dos renglones).
                            </div>
                        </div>

                        <button type="submit" class="btn btn-primary btn-lg w-100">Enviar Mensaje</button>
                    </form>
                </div>
            </div>
        </div>
        <!-- FIN SECCIÓN PRINCIPAL -->
    </main>

<!-- 1. Botón Flotante del Chatbot -->
    <button id="chatbot-toggle-button" class="p-3" data-bs-toggle="modal" data-bs-target="#chatbotModal">
        <i class="fas fa-question-circle fa-2x"></i>
    </button>

    <!-- 2. Modal del Chatbot -->
    <div class="modal fade" id="chatbotModal" tabindex="-1" aria-labelledby="chatbotModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content rounded-lg shadow-lg">
                
                <!-- Encabezado del Chatbot -->
                <div class="modal-header bg-primary text-white p-3 rounded-top d-flex align-items-center">
                    <i class="fas fa-comment-dots me-2 fa-lg"></i> 
                    <h5 class="modal-title flex-grow-1" id="chatbotModalLabel">
                        Asistente Jurídico
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>

                <!-- Cuerpo del Chat: Historial y Sugerencias -->
                <div class="modal-body p-0">
                    <div class="chat-container" id="chat-container">
                        <!-- Mensaje de bienvenida inicial -->
                        <div class="message bot-message">
                            Hola, soy tu Asistente Jurídico. ¿En qué área legal podemos asistirte hoy?
                        </div>
                    </div>
                    
                    <!-- Sugerencias de Inicio (Pills) -->
                     <div class="p-3 border-top d-flex flex-wrap" id="chat-suggestions">
                        <span class="badge rounded-pill bg-info text-dark chat-suggestion" onclick="sendSuggestion('Necesito ayuda con un contrato')">Contratos</span>
                        <span class="badge rounded-pill bg-info text-dark chat-suggestion" onclick="sendSuggestion('Pregunta sobre herencias o divorcios')">Derecho Civil</span>
                        <span class="badge rounded-pill bg-info text-dark chat-suggestion" onclick="sendSuggestion('Consultar sobre límites de propiedad')">Catastral</span>
                        <span class="badge rounded-pill bg-info text-dark chat-suggestion" onclick="sendSuggestion('Quiero presentar una tuteta')">Tutelas, Derechos de Petición, Acción Popular</span>
                    </div>

                    <!-- Entrada de Usuario -->
                    <div class="p-3 border-top d-flex">
                        <input type="text" id="user-input" class="form-control me-2 rounded-pill" placeholder="Escribe tu consulta aquí..." onkeydown="if (event.keyCode === 13) document.getElementById('send-button').click()">
                        <button class="btn btn-primary rounded-pill" id="send-button" onclick="sendMessage()">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <br>

    <footer>
        &copy; 2025 AMC Global Servicios. Todos los derechos reservados.
    </footer>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>


    <script>
        // Función de utilidad para limpiar la clase de error
        function clearError(inputElement) {
            inputElement.classList.remove('is-invalid');
        }

        // Función principal de validación de formularios
        function validateForm(event) {
            // Evitar el envío inmediato para poder manejar la validación
            event.preventDefault(); 
            
            let isValid = true;
            const form = document.getElementById('contactForm');
            
            // --- Campos y Valores ---
            const nombreInput = document.getElementById('nombre');
            const telefonoInput = document.getElementById('telefono');
            const emailInput = document.getElementById('email');
            const mensajeInput = document.getElementById('mensaje');

            const nombreValue = nombreInput.value.trim();
            const telefonoValue = telefonoInput.value.trim();
            const emailValue = emailInput.value.trim();
            const mensajeValue = mensajeInput.value.trim();

            // --- Validaciones ---

            // 1. Validar Nombre (solo letras, tildes, espacios y mínimo 4 caracteres)
            const nombreRegex = /^[a-zA-Z\sáéíóúÁÉÍÓÚñÑ]+$/; 
            if (!nombreRegex.test(nombreValue) || nombreValue.length < 4) {
                nombreInput.classList.add('is-invalid');
                isValid = false;
            } else {
                clearError(nombreInput);
            }

            // 2. Validar Teléfono (solo números, +, -, espacios y mínimo 10 dígitos limpios)
            // Se limpia la cadena para contar solo dígitos
            const cleanTelefono = telefonoValue.replace(/[^\d]/g, ''); 
            // Permite el formato de teléfono
            const telefonoRegex = /^\+?[\d\s-]{10,}$/;

            if (!telefonoRegex.test(telefonoValue) || cleanTelefono.length < 10) {
                telefonoInput.classList.add('is-invalid');
                isValid = false;
            } else {
                clearError(telefonoInput);
            }

            // 3. Validar Correo Electrónico (formato correcto y extensión completa)            
            const emailRegex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/;

            if (!emailRegex.test(emailValue)) {
                emailInput.classList.add('is-invalid');
                isValid = false;
            } else {
                clearError(emailInput);
            }

            // 4. Validar Mensaje (mínimo 30 caracteres)
            const MIN_MENSAJE_LENGTH = 30;
            if (mensajeValue.length < MIN_MENSAJE_LENGTH) {
                mensajeInput.classList.add('is-invalid');
                isValid = false;
            } else {
                clearError(mensajeInput);
            }


            // --- Envío del Formulario ---
            if (isValid) {
                // Espacio código para enviar los datos
                
                // Mostrar un modal o mensaje de éxito en lugar de alert()
                showSuccessMessage('¡Mensaje enviado con éxito!', 'Gracias por contactarnos. Un experto legal se comunicará contigo pronto.');
                form.reset(); 
            }

            return isValid;
        }

        // Función para mostrar un mensaje de éxito
        function showSuccessMessage(title, message) {
             // Reemplaza el contenido del formulario con un mensaje de éxito temporal.
             const formContainer = document.querySelector('.col-lg-7 .p-4');
             if (formContainer) {
                 formContainer.innerHTML = `
                    <div class="alert alert-success p-5 text-center" role="alert">
                        <i class="fas fa-check-circle fa-4x mb-3"></i>
                        <h4 class="alert-heading">${title}</h4>
                        <p class="mb-0">${message}</p>
                        <hr>
                        <button class="btn btn-sm btn-outline-success mt-2" onclick="window.location.reload();">Volver al Formulario</button>
                    </div>
                `;
             }
        }

        // limpiar los errores en tiempo real
        document.getElementById('nombre').addEventListener('input', function() { clearError(this); });
        document.getElementById('telefono').addEventListener('input', function() { clearError(this); });
        document.getElementById('email').addEventListener('input', function() { clearError(this); });
        document.getElementById('mensaje').addEventListener('input', function() { clearError(this); });

        // Configuración de la API
        const API_KEY = "AIzaSyB4nXF-fNgMOsTKOAnSwV_z3UMeRErPsIU";
        const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${API_KEY}`;
        
        // Elementos del DOM
        const chatContainer = document.getElementById('chat-container');
        const userInput = document.getElementById('user-input');
        const sendButton = document.getElementById('send-button');
        
        // Prompt de Sistema que define el rol del bot
        const SYSTEM_PROMPT = "Actúa como un asistente jurídico especializado de AMC Global Servicios. Mantén un tono formal y profesional. Tu único objetivo es clasificar la consulta del usuario y dirigirlo al especialista o servicio correcto. SOLO debes responder preguntas directamente relacionadas con los servicios y áreas legales publicadas en la página web (Contratos, Derecho Civil, Catastral, Derecho Constitucional o Acciones Constitucionales). Si la consulta es ajena a las actividades publicadas, informa cortésmente que solo puedes asistir en las áreas de práctica de AMC y ofrece el contacto. Limita las respuestas a 3 oraciones.";

        let isBotTyping = false;

        /**
         * Agrega un mensaje a la interfaz del chat.
         * @param {string} text - El texto del mensaje.
         * @param {string} sender - 'user' o 'bot'.
         */
        function addMessage(text, sender) {
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('message');
            messageDiv.classList.add(sender === 'user' ? 'user-message' : 'bot-message');
            messageDiv.innerHTML = text; //innerHTML para permitir enlaces
            chatContainer.appendChild(messageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight; // Auto-scroll
        }
        
        /**
         * Muestra un indicador de que el bot está escribiendo.
         * @returns {HTMLElement} El elemento del indicador.
         */
        function showTypingIndicator() {
            const typingDiv = document.createElement('div');
            typingDiv.classList.add('typing-indicator');
            typingDiv.id = 'typing-indicator';
            typingDiv.textContent = 'Asistente escribiendo...';
            chatContainer.appendChild(typingDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
            return typingDiv;
        }

        /**
         * Elimina el indicador de que el bot está escribiendo.
         * @param {HTMLElement} indicator - El elemento del indicador a eliminar.
         */
        function removeTypingIndicator(indicator) {
            if (indicator) {
                indicator.remove();
            }
        }

        /**
         * Realiza la llamada a la API de Gemini (con retries por backoff).
         * @param {string} message - El mensaje del usuario.
         */
        async function fetchGeminiResponse(message, attempt = 0) {
            const indicator = showTypingIndicator();
            const maxAttempts = 5;
            sendButton.disabled = true;
            isBotTyping = true;
            
            const payload = {
                contents: [{ parts: [{ text: message }] }],
                tools: [{ "google_search": {} }],
                systemInstruction: { parts: [{ text: SYSTEM_PROMPT }] },
            };

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (response.status === 429 && attempt < maxAttempts - 1) {
                    const delay = Math.pow(2, attempt) * 1000 + Math.random() * 1000;
                    console.warn(`Rate limit exceeded. Retrying in ${delay / 1000}s...`);
                    await new Promise(resolve => setTimeout(resolve, delay));
                    return fetchGeminiResponse(message, attempt + 1);
                }

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const result = await response.json();
                const text = result.candidates?.[0]?.content?.parts?.[0]?.text || 
                             "Disculpa, no pude procesar tu solicitud. Por favor, reformula la pregunta.";
                
                removeTypingIndicator(indicator);
                addMessage(text, 'bot');

            } catch (error) {
                console.error("Error al comunicarse con la API de Gemini:", error);
                removeTypingIndicator(indicator);
                addMessage("Lo sentimos, en este momento no podemos contactar al servidor. Por favor, contacte a nuestros abogados directamente por WhatsApp o [página de Contacto](/pages/contacto.html).", 'bot');
            } finally {
                sendButton.disabled = false;
                isBotTyping = false;
            }
        }

        /**
         * Maneja el envío de mensajes del usuario.
         */
        function sendMessage() {
            if (isBotTyping) return; // Evita enviar mensajes mientras el bot responde

            const message = userInput.value.trim();
            if (message === '') return;

            addMessage(message, 'user');
            fetchGeminiResponse(message);
            userInput.value = ''; // Limpia el input
        }

        /**
         * Envía una sugerencia predefinida.
         * @param {string} suggestion - El texto de la sugerencia.
         */
        function sendSuggestion(suggestion) {
            if (isBotTyping) return;
            addMessage(suggestion, 'user');
            fetchGeminiResponse(suggestion);
        }

        // Asegurar que el botón de envío y el enter funcionen correctamente
        document.getElementById('send-button').addEventListener('click', sendMessage);
        userInput.addEventListener('keydown', (event) => {
            if (event.key === 'Enter') {
                sendMessage();
            }
        });

    </script>
</body>
</html>
