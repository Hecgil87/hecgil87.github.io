<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AMC Sitio Web</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/CSS/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
</head>
<body>    
    <div id="top-bar" class="bg-dark text-white d-none d-md-block">
        <div class="container">
            <div class="row align-items-center">
                
                <div class="col-md-6 text-start small">
                    <span class="me-3"><i class="fas fa-envelope me-1"></i> amcglobalserviciossas@gmail.com</span>
                    <span><i class="fas fa-phone-alt me-1"></i> +57 316 8222210</span>
                </div>

                <div class="col-md-6 text-end">
                    <span class="me-3">Nuestras Redes Sociales</span>
                    <a href="#" class="text-white me-2"><i class="fab fa-facebook-f"></i></a>
                    <a href="#" class="text-white"><i class="fab fa-linkedin-in"></i></a>
                </div>
            </div>
        </div>
    </div>
    <header class="py-3 bg-white shadow-sm sticky-top">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-auto">
                    <a href="/index.html" class="d-flex align-items-center text-decoration-none">
                        <img src="/img/AMC_logo.png" alt="Logo AMC" class="logo img-fluid me-3">
                        <div>
                            <h1 class="siteTitle mb-0">AMC Global Servicios S.A.S.</h1>
                            <p class="siteSubtitle mb-0 d-none d-sm-block">Soluciones jurídicas a su medida</p>
                        </div>
                    </a>
                </div>
                
                <div class="col">
                    <nav class="navbar navbar-expand-lg p-0">
                        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNav" aria-controls="mainNav" aria-expanded="false" aria-label="Toggle navigation">
                            <span class="navbar-toggler-icon"></span>
                        </button>
                        <div class="collapse navbar-collapse" id="mainNav">
                            <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
                                <li class="nav-item">
                                    <a class="nav-link" href="/index.html">INICIO</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="/pages/nosotros.html">NOSOTROS</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="contacto.html">CONTACTO</a>
                                </li>
                                <li class="nav-item dropdown">
                                    <a class="nav-link dropdown-toggle" href="#" id="serviciosDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">NUESTROS SERVICIOS</a>
                                    <ul class="dropdown-menu" aria-labelledby="serviciosDropdown">
                                        <li><a class="dropdown-item" href="./servicios/Der_ConAct.html">Derecho Contractual</a></li>
                                        <li><a class="dropdown-item" href="./servicios/Der_Civil.html">Derecho Civil</a></li>
                                        <li><a class="dropdown-item" href="./servicios/Der_Cat.html">Derecho Catastral</a></li>
                                        <li><a class="dropdown-item" href="./servicios/Acciones_const.html">Acciones Constitucionales</a></li>
                                    </ul>
                                </li>                                
                            </ul>
                        </div>
                    </nav>
                </div>
            </div>
        </div>
    </header>
    <main class="mt-4">
        <!-- Nota: Eliminamos el <hr> que estaba dentro del container para que el fondo llegue al borde -->

        <!-- La clase abstract-legal-bg se extiende a todo el ancho de la ventana -->
        <section class="abstract-legal-bg">
            <!-- AGREGAMOS UN CONTAINER DENTRO para limitar el texto y que el padding se vea correcto -->
            <div class="container">
                <hr class="mb-5 mt-0">
            <h2>¿Quiénes SOMOS?</h2>
            <p>
                AMC Global Servicios es una firma dedicada a ofrecer soluciones integrales en el ámbito jurídico y tecnológico. Con un equipo multidisciplinario de profesionales, nos especializamos en brindar asesoría legal y servicios tecnológicos adaptados a las necesidades de nuestros clientes.
            </p>
            <h2>Misión</h2>
            <p>
                Brindar servicios jurídicos y tecnológicos de alta calidad, orientados a satisfacer las necesidades de personas naturales y empresas, con ética, responsabilidad y compromiso.
            </p>
            <h2>Visión</h2>
            <p>
                Ser reconocidos como líderes en soluciones jurídicas y tecnológicas, innovando constantemente y generando confianza en nuestros clientes a nivel nacional e internacional.
            </p>
        </section>

    </main>

    <!-- 1. Botón Flotante del Chatbot -->
    <button id="chatbot-toggle-button" class="p-3" data-bs-toggle="modal" data-bs-target="#chatbotModal">
        <i class="fas fa-question-circle fa-2x"></i>
    </button>

    <!-- 2. Modal del Chatbot -->
    <div class="modal fade" id="chatbotModal" tabindex="-1" aria-labelledby="chatbotModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content rounded-lg shadow-lg">
                
                <!-- Encabezado del Chatbot -->
                <div class="modal-header bg-primary text-white p-3 rounded-top d-flex align-items-center">
                    <i class="fas fa-comment-dots me-2 fa-lg"></i> 
                    <h5 class="modal-title flex-grow-1" id="chatbotModalLabel">
                        Asistente Jurídico
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>

                <!-- Cuerpo del Chat: Historial y Sugerencias -->
                <div class="modal-body p-0">
                    <div class="chat-container" id="chat-container">
                        <!-- Mensaje de bienvenida inicial -->
                        <div class="message bot-message">
                            Hola, soy tu Asistente Jurídico. ¿En qué área legal podemos asistirte hoy?
                        </div>
                    </div>
                    
                    <!-- Sugerencias de Inicio (Pills) -->
                     <div class="p-3 border-top d-flex flex-wrap" id="chat-suggestions">
                        <span class="badge rounded-pill bg-info text-dark chat-suggestion" onclick="sendSuggestion('Necesito ayuda con un contrato')">Contratos</span>
                        <span class="badge rounded-pill bg-info text-dark chat-suggestion" onclick="sendSuggestion('Pregunta sobre herencias o divorcios')">Derecho Civil</span>
                        <span class="badge rounded-pill bg-info text-dark chat-suggestion" onclick="sendSuggestion('Consultar sobre límites de propiedad')">Catastral</span>
                        <span class="badge rounded-pill bg-info text-dark chat-suggestion" onclick="sendSuggestion('Quiero presentar una tuteta')">Tutelas, Derechos de Petición, Acción Popular</span>
                    </div>

                    <!-- Entrada de Usuario -->
                    <div class="p-3 border-top d-flex">
                        <input type="text" id="user-input" class="form-control me-2 rounded-pill" placeholder="Escribe tu consulta aquí..." onkeydown="if (event.keyCode === 13) document.getElementById('send-button').click()">
                        <button class="btn btn-primary rounded-pill" id="send-button" onclick="sendMessage()">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer>
        &copy; 2025 AMC Global Servicios. Todos los derechos reservados.
    </footer>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
        // Configuración de la API
        const API_KEY = "AIzaSyB4nXF-fNgMOsTKOAnSwV_z3UMeRErPsIU";
        const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${API_KEY}`;
        
        // Elementos del DOM
        const chatContainer = document.getElementById('chat-container');
        const userInput = document.getElementById('user-input');
        const sendButton = document.getElementById('send-button');
        
        // Prompt de Sistema que define el rol del bot
        const SYSTEM_PROMPT = "Actúa como un asistente jurídico especializado de AMC Global Servicios. Mantén un tono formal y profesional. Tu único objetivo es clasificar la consulta del usuario y dirigirlo al especialista o servicio correcto. SOLO debes responder preguntas directamente relacionadas con los servicios y áreas legales publicadas en la página web (Contratos, Derecho Civil, Catastral, Derecho Constitucional o Acciones Constitucionales). Si la consulta es ajena a las actividades publicadas, informa cortésmente que solo puedes asistir en las áreas de práctica de AMC y ofrece el contacto. Limita las respuestas a 3 oraciones.";

        let isBotTyping = false;

        /**
         * Agrega un mensaje a la interfaz del chat.
         * @param {string} text - El texto del mensaje.
         * @param {string} sender - 'user' o 'bot'.
         */
        function addMessage(text, sender) {
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('message');
            messageDiv.classList.add(sender === 'user' ? 'user-message' : 'bot-message');
            messageDiv.innerHTML = text; //innerHTML para permitir enlaces
            chatContainer.appendChild(messageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight; // Auto-scroll
        }
        
        /**
         * Muestra un indicador de que el bot está escribiendo.
         * @returns {HTMLElement} El elemento del indicador.
         */
        function showTypingIndicator() {
            const typingDiv = document.createElement('div');
            typingDiv.classList.add('typing-indicator');
            typingDiv.id = 'typing-indicator';
            typingDiv.textContent = 'Asistente escribiendo...';
            chatContainer.appendChild(typingDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
            return typingDiv;
        }

        /**
         * Elimina el indicador de que el bot está escribiendo.
         * @param {HTMLElement} indicator - El elemento del indicador a eliminar.
         */
        function removeTypingIndicator(indicator) {
            if (indicator) {
                indicator.remove();
            }
        }

        /**
         * Realiza la llamada a la API de Gemini (con retries por backoff).
         * @param {string} message - El mensaje del usuario.
         */
        async function fetchGeminiResponse(message, attempt = 0) {
            const indicator = showTypingIndicator();
            const maxAttempts = 5;
            sendButton.disabled = true;
            isBotTyping = true;
            
            const payload = {
                contents: [{ parts: [{ text: message }] }],
                tools: [{ "google_search": {} }],
                systemInstruction: { parts: [{ text: SYSTEM_PROMPT }] },
            };

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (response.status === 429 && attempt < maxAttempts - 1) {
                    const delay = Math.pow(2, attempt) * 1000 + Math.random() * 1000;
                    console.warn(`Rate limit exceeded. Retrying in ${delay / 1000}s...`);
                    await new Promise(resolve => setTimeout(resolve, delay));
                    return fetchGeminiResponse(message, attempt + 1);
                }

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const result = await response.json();
                const text = result.candidates?.[0]?.content?.parts?.[0]?.text || 
                             "Disculpa, no pude procesar tu solicitud. Por favor, reformula la pregunta.";
                
                removeTypingIndicator(indicator);
                addMessage(text, 'bot');

            } catch (error) {
                console.error("Error al comunicarse con la API de Gemini:", error);
                removeTypingIndicator(indicator);
                addMessage("Lo sentimos, en este momento no podemos contactar al servidor. Por favor, contacte a nuestros abogados directamente por WhatsApp o [página de Contacto](/pages/contacto.html).", 'bot');
            } finally {
                sendButton.disabled = false;
                isBotTyping = false;
            }
        }

        /**
         * Maneja el envío de mensajes del usuario.
         */
        function sendMessage() {
            if (isBotTyping) return; // Evita enviar mensajes mientras el bot responde

            const message = userInput.value.trim();
            if (message === '') return;

            addMessage(message, 'user');
            fetchGeminiResponse(message);
            userInput.value = ''; // Limpia el input
        }

        /**
         * Envía una sugerencia predefinida.
         * @param {string} suggestion - El texto de la sugerencia.
         */
        function sendSuggestion(suggestion) {
            if (isBotTyping) return;
            addMessage(suggestion, 'user');
            fetchGeminiResponse(suggestion);
        }

        // Asegurar que el botón de envío y el enter funcionen correctamente
        document.getElementById('send-button').addEventListener('click', sendMessage);
        userInput.addEventListener('keydown', (event) => {
            if (event.key === 'Enter') {
                sendMessage();
            }
        });
    </script>

</body>
</html>
